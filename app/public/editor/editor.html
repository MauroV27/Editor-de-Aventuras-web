<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adventure Editor</title>
    <link rel="stylesheet" href="/static/css/editor.css">
    
    <script src="/static/components.js"></script>
    <script src="/static/abstractionLayer.js"></script>
    <script src="/static/hotspotControler.js"></script>
    <script src="/static/playerRender.js"></script>
    <script src="/static/editorRender.js"></script>
</head>
<body>
    <div class="container">

        <div class="frameViewContainer">

            <!-- Menu superior -->
            <div class="config-menu">
                <div class="menu-options">
                    <button onclick="saveAdventure()"><span class="menu-icon" title="Salvar aventura">üñ´</span></button> <!-- https://symbl.cc/en/1F5AB/ -->
                </div>
            </div>


            <div class="frameRender">
                <!-- Canvas view for render image and hotspots -->
                <canvas id="frameCanvas" width="960px" height="540px"></canvas>
            </div>
        </div>

        <div class="verticalPanel">
            <div class="frameProperties">
                <h3 id="nameFrameView">Frame name</h3>
                <div class="hotspotList"></div>
                <button onclick="openPopup()" class="btn-action">+ √Årea clicavel</button>
            </div>
            
            <div class="framesManager">
                <h3>Lista de frames:</h3>

                <div class="framesList"></div>

                <button id="btnAddFrame" class="btn-action" onclick="addFrame()">Novo Frame</button>

            </div>
        </div>

    </div>

    <div id="modalOne" class="modal"></div>

    <script>

        // const CANVAS_BORDER = 10;
        const canvas = document.querySelector('#frameCanvas');
        const ctx = canvas.getContext('2d');

        const ediotRender = new EditorRender(canvas, ctx);


        async function start(){

            // get advenure id from URL : 
            const url = document.URL || window.location.href ;
            const adventrueID = url.split("/").reverse()[0];

            // Load json data in player render
            await ediotRender.loadDataFromServer( adventrueID );

            // Events for interaction : 
            ediotRender.trackInputPosition(window, "mousemove");
            ediotRender.trackInputPosition(window, "mouseenter");
            ediotRender.trackInputPosition(window, "mouseleave");

            // Action events : Click in player
            window.addEventListener("mousedown", (e) => ediotRender.selectPoint(e), false);
            window.addEventListener("mouseup",   (e) => ediotRender.deselect(e), false);            
            // window.addEventListener("mousemove", (e) => ediotRender.move(e), false); // Not used for mouse operations
            
            // Show frame and content in canvas : 
            ediotRender.renderCurrentFrame(); // true -> render only one time ( better performance )

        }

        start();

        function addFrame() {
            ediotRender.addFrame();
        }

        function selectFrame(index) {
            ediotRender.selectFrame(index);
        }

        function removeFrame(index) {
            ediotRender.removeFrame(index);
        }

        function openPopup() {
            ediotRender.openPopup();
        }

        function closePopup() {
            ediotRender.closePopup();
        }
        
        function addHotSpot() {
            ediotRender.addHotSpot();
        }

        function editHotSpot(frameIndex, hotSpotIndex) {
            ediotRender.editHotSpot(frameIndex, hotSpotIndex);
        }

        function deleteHotSpot(frameIndex, hotSpotIndex) {
            ediotRender.deleteHotSpot(frameIndex, hotSpotIndex);
        }

        function saveAdventure(){
            const resp = confirm("Deseja salvar essa aventure?");

            if (resp){
                ediotRender.saveDataInServer();
            }

        }

    </script>
</body>
</html>